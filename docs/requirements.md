# 要件定義書

## プロジェクト概要
Route53で管理しているカスタムドメインを使用して、Gmailでカスタムドメインのメールアドレスを送受信可能にするプロジェクト。

## ビジネス要件

### 目的
- 個人または小規模チームでプロフェッショナルなカスタムドメインメールアドレスを使用
- 既存のGmailインターフェースを活用し、学習コストを削減
- 低コストで運用可能なメールシステムの構築

### 対象ユーザー
- Route53でドメインを管理している個人・組織
- Gmailを主要なメールクライアントとして使用しているユーザー
- フルマネージドなメールソリューションを求めるユーザー

## 機能要件

### FR1: メール受信機能
- **FR1.1**: カスタムドメイン宛のメール（例: `user@example.com`）を受信
- **FR1.2**: 受信したメールをGmailアカウントに転送
- **FR1.3**: メールの添付ファイルを含む完全な転送
- **FR1.4**: スパムフィルタリング（オプション）

### FR2: メール送信機能
- **FR2.1**: Gmailからカスタムドメインのアドレスで送信
- **FR2.2**: 送信者認証（SPF/DKIM/DMARC）の実装
- **FR2.3**: 送信ドメインの評価維持（スパム判定回避）

### FR3: DNS管理
- **FR3.1**: Route53でのMXレコード設定
- **FR3.2**: SPF/DKIM/DMARCレコード設定
- **FR3.3**: ドメイン認証レコード設定

## 非機能要件

### NFR1: 可用性
- **NFR1.1**: 99.9%以上のメール受信可用性
- **NFR1.2**: メール配送遅延は通常5分以内

### NFR2: セキュリティ
- **NFR2.1**: TLS/SSL暗号化通信
- **NFR2.2**: DKIM署名による送信元検証
- **NFR2.3**: SPFレコードによる送信元認証
- **NFR2.4**: DMARCポリシーの実装

### NFR3: コスト
- **NFR3.1**: 月額コスト目標: $5以下（低トラフィック想定）
- **NFR3.2**: 従量課金モデルの採用

### NFR4: 運用性
- **NFR4.1**: セットアップ時間: 1日以内
- **NFR4.2**: 自動化されたデプロイメント（IaC）
- **NFR4.3**: ログとモニタリングの実装

## 制約条件

### 技術制約
- Route53でドメインが管理されていること
- AWSアカウントへのアクセス権限があること
- Gmailアカウントを所有していること

### ビジネス制約
- 初期セットアップは手動作業を許容
- 大量メール送信（マーケティング）は対象外
- 個人・小規模利用を想定（1日100通以内）

## 成功基準

1. カスタムドメインでメールを送受信できること
2. メール配送の信頼性が95%以上であること
3. スパムフォルダに振り分けられる率が5%以下であること
4. セットアップドキュメントに従って第三者が構築可能であること
5. 月額運用コストが目標範囲内であること

## リスクと対策

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|----------|------|
| SESサンドボックス制限 | 高 | 中 | 本番移行申請プロセスのドキュメント化 |
| スパム判定 | 中 | 中 | SPF/DKIM/DMARC適切設定、送信元評価モニタリング |
| Lambdaタイムアウト | 低 | 低 | 適切なタイムアウト設定、再試行ロジック |
| コスト超過 | 低 | 低 | CloudWatchアラート設定、使用量モニタリング |
